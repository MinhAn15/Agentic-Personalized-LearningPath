
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Agent 5: Evaluator - Deep Dive Whitebox</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;     /* Slate 900 */
            --accent: #3b82f6;      /* Blue 500 */
            --success: #10b981;     /* Emerald 500 */
            --warning: #f59e0b;     /* Amber 500 */
            --danger: #ef4444;      /* Red 500 */
            --bg: #f8fafc;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
        }
        
        body { font-family: 'Inter', sans-serif; padding: 40px; background: var(--bg); color: #334155; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* Header */
        .header { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 40px; border-top: 6px solid var(--accent); }
        .header h1 { margin: 0; color: var(--primary); font-size: 2.8em; letter-spacing: -0.02em; }
        .role-title { font-size: 1.4em; color: #64748b; margin-top: 10px; font-weight: 500; }
        
        .badges { margin-top: 25px; display: flex; gap: 12px; flex-wrap: wrap; }
        .badge { padding: 6px 14px; border-radius: 24px; font-weight: 600; font-size: 0.9em; }
        .badge-science { background: #eff6ff; color: var(--accent); border: 1px solid #bfdbfe; }
        .badge-tech { background: #f0fdf4; color: var(--success); border: 1px solid #bbf7d0; }
        
        /* Diagram */
        .card { background: white; padding: 30px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .key-insight { 
            margin-top: 20px; padding: 20px; 
            border-left: 4px solid var(--warning); 
            background: #fffbeb; color: #92400e;
            font-size: 1.1em;
        }
        
        /* Phase Steps */
        .phase-section h2 { color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-top: 0; }
        
        .step { margin-bottom: 40px; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
        .step-header { 
            padding: 15px 25px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .step-title { font-weight: 700; color: var(--primary); font-size: 1.1em; }
        .method-code { font-family: 'Fira Code', monospace; background: #e2e8f0; color: #475569; padding: 4px 8px; border-radius: 6px; font-size: 0.9em; }
        
        .step-body { padding: 25px; }
        .step-desc { font-size: 1.05em; margin-bottom: 20px; color: #1e293b; }
        
        /* IO Grid */
        .io-grid { display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 20px; margin-bottom: 20px; }
        .io-box { padding: 15px; border-radius: 8px; font-size: 0.95em; }
        .io-label { text-transform: uppercase; font-size: 0.75em; font-weight: 700; margin-bottom: 8px; letter-spacing: 0.05em; }
        
        .io-input { background: #f1f5f9; border: 1px solid #cbd5e1; }
        .io-mech { background: #eef2ff; border: 1px solid #c7d2fe; }
        .io-output { background: #f0fdf4; border: 1px solid #bbf7d0; }
        
        /* Deep Dive collapsible */
        details.deep-dive { margin-top: 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        details.deep-dive summary { 
            padding: 12px 20px; background: #f8fafc; cursor: pointer; font-weight: 600; color: var(--accent);
            list-style: none; display: flex; align-items: center; gap: 8px;
        }
        details.deep-dive summary::before { content: "‚öôÔ∏è"; }
        details.deep-dive[open] summary { border-bottom: 1px solid #e2e8f0; }
        
        .dive-content { padding: 20px; background: #ffffff; }
        
        pre { margin: 0; background: var(--code-bg); padding: 15px; border-radius: 8px; overflow-x: auto; }
        code { font-family: 'Fira Code', monospace; color: var(--code-text); font-size: 0.9em; }
        
        .formula-box { 
            background: #fff; border-left: 4px solid var(--secondary); padding: 15px; margin: 15px 0; font-family: 'Times New Roman', serif; font-style: italic; font-size: 1.1em; 
        }

        /* Complexity Card */
        .complexity-card { background: #1e293b; color: white; padding: 30px; border-radius: 16px; margin-top: 40px; }
        .complexity-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 20px; }
        .metric { text-align: center; }
        .metric-val { font-size: 2em; font-weight: 700; color: var(--accent); }
        .metric-label { font-size: 0.9em; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }

        /* Detail Panel */
        .backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 90; }
        .backdrop.active { opacity: 1; pointer-events: all; }
        
        .detail-panel { 
            position: fixed; top: 0; right: -500px; width: 450px; height: 100%; 
            background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); 
            transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100; overflow-y: auto;
        }
        .detail-panel.active { right: 0; }
        
        .panel-header { background: var(--primary); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; }
        .panel-header h2 { margin: 0; font-size: 1.3em; }
        
        .panel-body { padding: 25px; }
        .panel-section { margin-bottom: 25px; font-size: 1em; color: #475569; }
        .panel-label { text-transform: uppercase; font-size: 0.75em; font-weight: 700; color: #94a3b8; margin-bottom: 8px; letter-spacing: 0.05em; }
        .panel-code { background: #f1f5f9; padding: 15px; border-radius: 8px; border: 1px solid #cbd5e1; font-family: 'Fira Code', monospace; font-size: 0.85em; color: var(--primary); white-space: pre-wrap; }

    </style>
</head>
<body>
    <div class="container">
        
        <div class="header">
            <div style="text-transform: uppercase; color: var(--accent); font-weight: 700; font-size: 0.9em; letter-spacing: 0.1em; margin-bottom: 10px;">Detailed Technical Specification</div>
            <h1>Agent 5: Evaluator</h1>
            <div class="role-title">The Judge (Th·∫©m ph√°n)</div>
            
            <p style="font-size: 1.1em; max-width: 800px; margin-top: 20px;">ƒê√°nh gi√° kh√¥ng ch·ªâ ƒê√∫ng/Sai (Binary) m√† c√≤n ƒë√°nh gi√° quy tr√¨nh t∆∞ duy, ph√¢n lo·∫°i l·ªói sai (Error Taxonomy) ƒë·ªÉ ƒë∆∞a ra h∆∞·ªõng x·ª≠ l√Ω s∆∞ ph·∫°m.</p>
            
            <div class="badges">
                <span class="badge badge-science">JudgeLM (Zhu 2023)</span><span class="badge badge-science">Bloom's Ref-as-Prior</span><span class="badge badge-science">Bayesian KT</span>
                <span class="badge badge-tech">Gemini 1.5</span><span class="badge badge-tech">WMA Smoothing</span><span class="badge badge-tech">Postgres</span>
            </div>
        </div>

        <div class="card">
            <h2>Process Architecture</h2>
            <div class="mermaid">

graph LR
    Input[Student Answer] --> Judge[JudgeLM Scoring]
    Ref[Golden Answer] --> Judge
    
    Judge -->|Score 0-10| Classify[Error Classifier]
    Classify -->|Taxonomy| Decision{5-Path Tree}
    
    Decision -->|Score > 8| Mastered[Mark Mastered]
    Decision -->|Score 5-8| Proceed[Proceed with Caution]
    Decision -->|Score < 5| Remediate[Trigger Remediation]
    
    Mastered --> Update[WMA Update]
    Proceed --> Update
    Remediate --> Update

    click Input showDetails
    click Ref showDetails
    click Judge showDetails
    click Classify showDetails
    click Decision showDetails
    click Mastered showDetails
    click Proceed showDetails
    click Remediate showDetails
    click Update showDetails
        
click Judge showDetails
click Classify showDetails
click Decision showDetails
click Update showDetails
click Input showDetails
click Ref showDetails
click Mastered showDetails
click Proceed showDetails
click Remediate showDetails
            </div>
            <div class="key-insight">
                <strong>üí° Core Deviation / Innovation:</strong> K·∫øt h·ª£p JudgeLM (v·ªõi k·ªπ thu·∫≠t Reference-as-Prior) v√† C√¢y quy·∫øt ƒë·ªãnh s∆∞ ph·∫°m (5 nh√°nh) ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng h·ªçc vi√™n: Mastered, Proceed, Alternate, Remediate, Retry.
            </div>
        </div>

        
            <div class="phase-section">
                <h2>Phase 1: Advanced Evaluation</h2>
                
                <div class="step">
                    <div class="step-header">
                        <span class="step-title">JudgeLM Logic</span>
                        <span class="method-code">_score_response()</span>
                    </div>
                    <div class="step-body">
                        <p class="step-desc">So kh·ªõp c√¢u tr·∫£ l·ªùi v·ªõi ƒê√°p √°n chu·∫©n d·ª±a tr√™n Rubric.</p>
                        
                        <div class="io-grid">
                            <div class="io-box io-input">
                                <div class="io-label">Input</div>
                                Ans + Ref + Rubric
                            </div>
                            <div class="io-box io-mech">
                                <div class="io-label">Mechanism</div>
                                LLM-as-a-Judge
                            </div>
                            <div class="io-box io-output">
                                <div class="io-label">Output</div>
                                Score + Rationale
                            </div>
                        </div>
                        
                        
                    <details class="deep-dive">
                        <summary>Deep Dive: Rubric Criteria</summary>
                        <div class="dive-content">
                            <pre><code>Evaluation Rubric:
1. Correctness (40%): Is the logic sound?
2. Completeness (30%): Are all constraints met?
3. Clarity (20%): Is it well explained?
4. Efficiency (10%): Is the solution optimal?

Input Format:
[Student Answer] vs [Reference Answer]</code></pre>
                        </div>
                    </details>
                    
                    </div>
                </div>
                
            </div>
            
            <div class="phase-section">
                <h2>Phase 2: Decision Engine</h2>
                
                <div class="step">
                    <div class="step-header">
                        <span class="step-title">5-Path Decision Tree</span>
                        <span class="method-code">_make_path_decision()</span>
                    </div>
                    <div class="step-body">
                        <p class="step-desc">Mapping ƒëi·ªÉm s·ªë v√† lo·∫°i l·ªói sang h√†nh ƒë·ªông ti·∫øp theo.</p>
                        
                        <div class="io-grid">
                            <div class="io-box io-input">
                                <div class="io-label">Input</div>
                                Score + ErrorType
                            </div>
                            <div class="io-box io-mech">
                                <div class="io-label">Mechanism</div>
                                Deterministic Rules
                            </div>
                            <div class="io-box io-output">
                                <div class="io-label">Output</div>
                                Action Enum
                            </div>
                        </div>
                        
                        
                    <details class="deep-dive">
                        <summary>Deep Dive: Logic Tree</summary>
                        <div class="dive-content">
                            <pre><code>IF Score >= 0.8:
    RETURN "MASTERED"
ELIF Score >= 0.6:
    RETURN "PROCEED"
ELIF ErrorType == "MISCONCEPTION":
    RETURN "REMEDIATE" (Concept Review)
ELIF ErrorType == "CARELESS":
    RETURN "RETRY" (Same Problem)
ELSE:
    RETURN "ALTERNATE" (Easier Problem)</code></pre>
                        </div>
                    </details>
                    
                    </div>
                </div>
                
            </div>
            
        
        <div class="complexity-card">
            <h2>Complexity & Performance Analysis</h2>
            <div class="complexity-grid">
                
            <div class="metric">
                <div class="metric-val">4</div>
                <div class="metric-label">Rubric Dims (count)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">5</div>
                <div class="metric-label">Taxonomy (types)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">5</div>
                <div class="metric-label">Paths (outcomes)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">~500</div>
                <div class="metric-label">Cost/Eval (tokens)</div>
            </div>
        
            </div>
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #334155;">
                <h3>Performance Bottleneck</h3>
                <p>None. Very lightweight execution.</p>
            </div>
        </div>

        <div style="text-align: center; color: #94a3b8; margin-top: 60px; font-size: 0.9em;">
             Thesis Defense System ‚Ä¢ Generated by Antigravity ‚Ä¢ 2026-01-14 18:01
        </div>
    </div>

    <!-- Detail Panel -->
    <div id="backdrop" class="backdrop" onclick="closeDetails()"></div>
    <div id="detail-panel" class="detail-panel">
        <div class="panel-header">
            <h2 id="panel-title">Component Details</h2>
            <button onclick="closeDetails()" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">√ó</button>
        </div>
        <div class="panel-body">
            <div id="panel-desc" class="panel-section"></div>
            
            <div class="panel-section" style="display:none; background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 25px;">
                <div class="panel-label" style="color: var(--accent);">Internal Logic</div>
                <div id="panel-logic" style="color: #334155; font-size: 0.95em;"></div>
            </div>

            <div class="panel-label">Technical Specs</div>
            <pre id="panel-specs" class="panel-code"></pre>
            
            <div class="panel-label">Source Reference</div>
            <div id="panel-source" style="font-family: 'Fira Code', monospace; color: var(--accent); font-size: 0.9em;"></div>
        </div>
    </div>

    <script>
        const NODE_DETAILS = {"Judge": {"title": "JudgeLM Scoring", "desc": "Evaluates answer quality using 'Reference-as-Prior' technique.", "logic": "1. Compare Student vs Golden Answer.\n2. Score on Rubric (Correctness 60%, Completeness 20%, Clarity 20%).", "specs": "Model: Gemini 1.5 Zero-shot\nOutput: 0.0 - 10.0", "source": "backend/agents/evaluator_agent.py"}, "Classify": {"title": "Error Classifier", "desc": "Categorizes the type of error for pedagogical response.", "logic": "Matches inputs to 4 categories:\n- Conceptual (Deep misunderstanding)\n- Procedural (Wrong steps)\n- Incomplete (Missing info)\n- Careless (Typo/Calc)", "specs": "Taxonomy: 4 Classes", "source": "backend/agents/evaluator_agent.py"}, "Decision": {"title": "5-Path Decision Engine", "desc": "Determines the next learning action based on Score + Error.", "logic": "- Mastered (>9.0)\n- Proceed (>8.0)\n- Alternate (>6.0)\n- Remediate (<6.0 + Conceptual)\n- Retry (<6.0 + Other)", "specs": "Paths: 5 Branch Logic", "source": "backend/agents/evaluator_agent.py"}, "Update": {"title": "Mastery Update (WMA)", "desc": "Updates the learner's knowledge state.", "logic": "Hybrid Update:\nNew = (Current * 0.4) + (Score * 0.6)\nUpdates Personal Knowledge Graph.", "specs": "Algorithm: Weighted Moving Average", "source": "backend/agents/evaluator_agent.py"}, "Input": {"title": "Student Input", "desc": "The raw answer provided by the learner.", "logic": "Input text stream.", "specs": "Type: String", "source": "Frontend"}, "Ref": {"title": "Golden Answer", "desc": "The ground truth answer from the curriculum.", "logic": "Retrieved from Vector Store or Concept Node.", "specs": "Source: RAG/KG", "source": "backend/agents/evaluator_agent.py"}, "Mastered": {"title": "Path: Mastered", "desc": "Outcome when score is high (>8-9).", "logic": "Confidence High -> Mark Concept as Learned.", "specs": "Threshold: > 0.8", "source": "backend/agents/evaluator_agent.py"}, "Proceed": {"title": "Path: Proceed", "desc": "Outcome when score is passing (5-8).", "logic": "Good enough to move on, but maybe review later.", "specs": "Threshold: 0.5 - 0.8", "source": "backend/agents/evaluator_agent.py"}, "Remediate": {"title": "Path: Remediate", "desc": "Outcome when score is low (<5).", "logic": "Needs review or alternative material.", "specs": "Threshold: < 0.5", "source": "backend/agents/evaluator_agent.py"}};

        function showDetails(nodeId) {
            const data = NODE_DETAILS[nodeId];
            if (!data) return;

            document.getElementById('panel-title').innerText = data.title;
            document.getElementById('panel-desc').innerHTML = data.desc;
            
            // Logic Section (New)
            const logicEl = document.getElementById('panel-logic');
            if (data.logic) {
                logicEl.innerText = data.logic;
                logicEl.parentElement.style.display = 'block';
            } else {
                logicEl.parentElement.style.display = 'none';
            }

            document.getElementById('panel-specs').innerText = data.specs || "No specific configuration.";
            document.getElementById('panel-source').innerText = data.source || "System Component";
            
            document.getElementById('backdrop').classList.add('active');
            document.getElementById('detail-panel').classList.add('active');
        }

        function closeDetails() {
            document.getElementById('backdrop').classList.remove('active');
            document.getElementById('detail-panel').classList.remove('active');
        }

        // Auto-attach clicks after Mermaid renders
        // Note: We use the native mermaid click directive in the graph definition
    </script>
</body>
</html>
