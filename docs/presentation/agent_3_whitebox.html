
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Agent 3: Path Planner - Deep Dive Whitebox</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;     /* Slate 900 */
            --accent: #3b82f6;      /* Blue 500 */
            --success: #10b981;     /* Emerald 500 */
            --warning: #f59e0b;     /* Amber 500 */
            --danger: #ef4444;      /* Red 500 */
            --bg: #f8fafc;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
        }
        
        body { font-family: 'Inter', sans-serif; padding: 40px; background: var(--bg); color: #334155; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* Header */
        .header { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 40px; border-top: 6px solid var(--accent); }
        .header h1 { margin: 0; color: var(--primary); font-size: 2.8em; letter-spacing: -0.02em; }
        .role-title { font-size: 1.4em; color: #64748b; margin-top: 10px; font-weight: 500; }
        
        .badges { margin-top: 25px; display: flex; gap: 12px; flex-wrap: wrap; }
        .badge { padding: 6px 14px; border-radius: 24px; font-weight: 600; font-size: 0.9em; }
        .badge-science { background: #eff6ff; color: var(--accent); border: 1px solid #bfdbfe; }
        .badge-tech { background: #f0fdf4; color: var(--success); border: 1px solid #bbf7d0; }
        
        /* Diagram */
        .card { background: white; padding: 30px; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .key-insight { 
            margin-top: 20px; padding: 20px; 
            border-left: 4px solid var(--warning); 
            background: #fffbeb; color: #92400e;
            font-size: 1.1em;
        }
        
        /* Phase Steps */
        .phase-section h2 { color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-top: 0; }
        
        .step { margin-bottom: 40px; background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; }
        .step-header { 
            padding: 15px 25px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .step-title { font-weight: 700; color: var(--primary); font-size: 1.1em; }
        .method-code { font-family: 'Fira Code', monospace; background: #e2e8f0; color: #475569; padding: 4px 8px; border-radius: 6px; font-size: 0.9em; }
        
        .step-body { padding: 25px; }
        .step-desc { font-size: 1.05em; margin-bottom: 20px; color: #1e293b; }
        
        /* IO Grid */
        .io-grid { display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 20px; margin-bottom: 20px; }
        .io-box { padding: 15px; border-radius: 8px; font-size: 0.95em; }
        .io-label { text-transform: uppercase; font-size: 0.75em; font-weight: 700; margin-bottom: 8px; letter-spacing: 0.05em; }
        
        .io-input { background: #f1f5f9; border: 1px solid #cbd5e1; }
        .io-mech { background: #eef2ff; border: 1px solid #c7d2fe; }
        .io-output { background: #f0fdf4; border: 1px solid #bbf7d0; }
        
        /* Deep Dive collapsible */
        details.deep-dive { margin-top: 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        details.deep-dive summary { 
            padding: 12px 20px; background: #f8fafc; cursor: pointer; font-weight: 600; color: var(--accent);
            list-style: none; display: flex; align-items: center; gap: 8px;
        }
        details.deep-dive summary::before { content: "‚öôÔ∏è"; }
        details.deep-dive[open] summary { border-bottom: 1px solid #e2e8f0; }
        
        .dive-content { padding: 20px; background: #ffffff; }
        
        pre { margin: 0; background: var(--code-bg); padding: 15px; border-radius: 8px; overflow-x: auto; }
        code { font-family: 'Fira Code', monospace; color: var(--code-text); font-size: 0.9em; }
        
        .formula-box { 
            background: #fff; border-left: 4px solid var(--secondary); padding: 15px; margin: 15px 0; font-family: 'Times New Roman', serif; font-style: italic; font-size: 1.1em; 
        }

        /* Complexity Card */
        .complexity-card { background: #1e293b; color: white; padding: 30px; border-radius: 16px; margin-top: 40px; }
        .complexity-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-top: 20px; }
        .metric { text-align: center; }
        .metric-val { font-size: 2em; font-weight: 700; color: var(--accent); }
        .metric-label { font-size: 0.9em; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }

        /* Detail Panel */
        .backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 90; }
        .backdrop.active { opacity: 1; pointer-events: all; }
        
        .detail-panel { 
            position: fixed; top: 0; right: -500px; width: 450px; height: 100%; 
            background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); 
            transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100; overflow-y: auto;
        }
        .detail-panel.active { right: 0; }
        
        .panel-header { background: var(--primary); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; }
        .panel-header h2 { margin: 0; font-size: 1.3em; }
        
        .panel-body { padding: 25px; }
        .panel-section { margin-bottom: 25px; font-size: 1em; color: #475569; }
        .panel-label { text-transform: uppercase; font-size: 0.75em; font-weight: 700; color: #94a3b8; margin-bottom: 8px; letter-spacing: 0.05em; }
        .panel-code { background: #f1f5f9; padding: 15px; border-radius: 8px; border: 1px solid #cbd5e1; font-family: 'Fira Code', monospace; font-size: 0.85em; color: var(--primary); white-space: pre-wrap; }

    </style>
</head>
<body>
    <div class="container">
        
        <div class="header">
            <div style="text-transform: uppercase; color: var(--accent); font-weight: 700; font-size: 0.9em; letter-spacing: 0.1em; margin-bottom: 10px;">Detailed Technical Specification</div>
            <h1>Agent 3: Path Planner</h1>
            <div class="role-title">The Navigator (ƒêi·ªÅu h∆∞·ªõng)</div>
            
            <p style="font-size: 1.1em; max-width: 800px; margin-top: 20px;">C√¢n b·∫±ng gi·ªØa k·∫ø ho·∫°ch chi·∫øn l∆∞·ª£c d√†i h·∫°n (System 2) v√† ph·∫£n ·ª©ng th√≠ch nghi nhanh (System 1) ƒë·ªÉ t·∫°o l·ªô tr√¨nh h·ªçc t·ªëi ∆∞u.</p>
            
            <div class="badges">
                <span class="badge badge-science">Tree of Thoughts (ToT)</span><span class="badge badge-science">LinUCB (Bandit)</span><span class="badge badge-science">Mental Simulation</span>
                <span class="badge badge-tech">Neo4j</span><span class="badge badge-tech">Gemini 1.5</span><span class="badge badge-tech">Redis MAB State</span><span class="badge badge-tech">Beam Search</span>
            </div>
        </div>

        <div class="card">
            <h2>Process Architecture</h2>
            <div class="mermaid">

graph TD
    Input[Profile Vector V] --> Check{Is First Plan?}
    
    subgraph System2[System 2: Strategic ToT]
        Check -- Yes --> Gen[Thought Generator]
        Gen -->|Expand b=3| Candidates
        Candidates --> Eval[State Evaluator]
        Eval -->|Simulate| Scores
        Scores --> Prune[Beam Pruning]
        Prune --> Path[Optimal Sequence]
    end
    
    subgraph System1[System 1: Adaptive LinUCB]
        Check -- No --> Bandit[LinUCB Algorithm]
        Bandit -->|Disjoint Models| Select[Select Next Concept]
    end
    
    Gate -->|Pass| Adaptive[Adaptive Chaining]
    Gate -->|Fail| Review[Forced Review Mode]
    
    click Input showDetails
    click Check showDetails
    click Gen showDetails
    click Candidates showDetails
    click Eval showDetails
    click Scores showDetails
    click Prune showDetails
    click Path showDetails
    click Bandit showDetails
    click Select showDetails
    click Gate showDetails
        
click Input showDetails
click Check showDetails
click Gen showDetails
click Eval showDetails
click Prune showDetails
click Bandit showDetails
click Gate showDetails
            </div>
            <div class="key-insight">
                <strong>üí° Core Deviation / Innovation:</strong> Ki·∫øn tr√∫c Hybrid: S·ª≠ d·ª•ng ToT (Beam Search) cho l·∫ßn l·∫≠p k·∫ø ho·∫°ch ƒë·∫ßu ti√™n ƒë·ªÉ tr√°nh Local Optima, sau ƒë√≥ chuy·ªÉn sang LinUCB (Contextual Bandit) ƒë·ªÉ ƒëi·ªÅu ch·ªânh si√™u t·ªëc t·ª´ng b∆∞·ªõc.
            </div>
        </div>

        
            <div class="phase-section">
                <h2>Phase 1: Strategic Planning (ToT)</h2>
                
                <div class="step">
                    <div class="step-header">
                        <span class="step-title">Beam Search (b=3, d=3)</span>
                        <span class="method-code">_beam_search()</span>
                    </div>
                    <div class="step-body">
                        <p class="step-desc">T√¨m ki·∫øm tr√™n c√¢y kh√¥ng gian tr·∫°ng th√°i v·ªõi ƒë·ªô r·ªông 3 v√† ƒë·ªô s√¢u 3.</p>
                        
                        <div class="io-grid">
                            <div class="io-box io-input">
                                <div class="io-label">Input</div>
                                Start Node + Goal Node
                            </div>
                            <div class="io-box io-mech">
                                <div class="io-label">Mechanism</div>
                                Tree Search + LLM Evaluator
                            </div>
                            <div class="io-box io-output">
                                <div class="io-label">Output</div>
                                Best Path Sequence
                            </div>
                        </div>
                        
                        
                    <details class="deep-dive">
                        <summary>Deep Dive: Complexity Cost</summary>
                        <div class="dive-content">
                            <pre><code>Cost Analysis for ToT (b=3, d=3):

Step 1: Generate 3 candidate thoughts (1 LLM Call)
Step 2: Evaluate 3 candidates (3 LLM Calls)
Step 3: Branch 3x3 = 9 next thoughts (3 LLM Calls)
Step 4: Evaluate 9 candidates (9 LLM Calls)
...
Total LLM Calls approx: 1 + b + b*b ...
Current Implementation Limit: Exactly 18 calls per plan.
Latency: ~9-12 seconds.</code></pre>
                        </div>
                    </details>
                    
                    </div>
                </div>
                
            </div>
            
            <div class="phase-section">
                <h2>Phase 2: Real-time Adaptation (LinUCB)</h2>
                
                <div class="step">
                    <div class="step-header">
                        <span class="step-title">Contextual Bandit Decision</span>
                        <span class="method-code">rl_engine.select()</span>
                    </div>
                    <div class="step-body">
                        <p class="step-desc">Ch·ªçn concept ti·∫øp theo d·ª±a tr√™n vector ƒë·∫∑c tr∆∞ng ng∆∞·ªùi h·ªçc v√† ma tr·∫≠n ph·∫ßn th∆∞·ªüng l·ªãch s·ª≠.</p>
                        
                        <div class="io-grid">
                            <div class="io-box io-input">
                                <div class="io-label">Input</div>
                                Context Vector (10-dim)
                            </div>
                            <div class="io-box io-mech">
                                <div class="io-label">Mechanism</div>
                                LinUCB Disjoint Algorithm
                            </div>
                            <div class="io-box io-output">
                                <div class="io-label">Output</div>
                                Next Concept ID
                            </div>
                        </div>
                        
                        
                    <details class="deep-dive">
                        <summary>Deep Dive: LinUCB Formula</summary>
                        <div class="dive-content">
                            <pre><code>For each arm (concept) 'a':

p_at = (theta_a_transpose * x_t) + alpha * sqrt(x_t_transpose * A_inv_a * x_t)

Where:
- x_t: Current user context vector
- theta_a: Feature weights for arm a (learned benefit)
- alpha: Exploration parameter (0.5)
- term 2: Uncertainty (Exploration bonus)

We select: argmax(p_at)</code></pre>
                        </div>
                    </details>
                    
                    </div>
                </div>
                
            </div>
            
        
        <div class="complexity-card">
            <h2>Complexity & Performance Analysis</h2>
            <div class="complexity-grid">
                
            <div class="metric">
                <div class="metric-val">18</div>
                <div class="metric-label">ToT Cost (calls)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">50</div>
                <div class="metric-label">LinUCB Latency (ms)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">3√ó3</div>
                <div class="metric-label">Space (b√ód)</div>
            </div>
        
            <div class="metric">
                <div class="metric-val">0.5</div>
                <div class="metric-label">Exploration (alpha)</div>
            </div>
        
            </div>
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #334155;">
                <h3>Performance Bottleneck</h3>
                <p>ToT Planning Latency (~10s). Only runs on first session or major drift.</p>
            </div>
        </div>

        <div style="text-align: center; color: #94a3b8; margin-top: 60px; font-size: 0.9em;">
             Thesis Defense System ‚Ä¢ Generated by Antigravity ‚Ä¢ 2026-01-14 18:01
        </div>
    </div>

    <!-- Detail Panel -->
    <div id="backdrop" class="backdrop" onclick="closeDetails()"></div>
    <div id="detail-panel" class="detail-panel">
        <div class="panel-header">
            <h2 id="panel-title">Component Details</h2>
            <button onclick="closeDetails()" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">√ó</button>
        </div>
        <div class="panel-body">
            <div id="panel-desc" class="panel-section"></div>
            
            <div class="panel-section" style="display:none; background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 25px;">
                <div class="panel-label" style="color: var(--accent);">Internal Logic</div>
                <div id="panel-logic" style="color: #334155; font-size: 0.95em;"></div>
            </div>

            <div class="panel-label">Technical Specs</div>
            <pre id="panel-specs" class="panel-code"></pre>
            
            <div class="panel-label">Source Reference</div>
            <div id="panel-source" style="font-family: 'Fira Code', monospace; color: var(--accent); font-size: 0.9em;"></div>
        </div>
    </div>

    <script>
        const NODE_DETAILS = {"Input": {"title": "Profile Vector", "desc": "10-dimensional numpy array representing Learner State.", "logic": "Normalized Input: [Mastery, Velocity, V, A, R, K, Time, Difficulty, Frustration, Bloom]", "specs": "Dim: 10\nSource: `Agent2.vectorize`", "source": "backend/agents/profiler_agent.py"}, "Check": {"title": "Strategy Switch", "desc": "Decides between expensive Planning (System 2) vs fast Adaptation (System 1).", "logic": "IF (New Session OR Concept Drift > 0.3) -> System 2 (ToT)\nELSE -> System 1 (LinUCB)", "specs": "Trigger: Cold Start OR Drift > Threshold", "source": "backend/agents/path_planner_agent.py"}, "Gen": {"title": "Thought Generator", "desc": "LLM proposes k=3 candidate next steps (Review, Scaffold, Challenge).", "logic": "1. Prompt LLM with current Concept + Goal.\n2. Ask for 3 distinct strategies (Review, Scaffold, Challenge).\n3. Return JSON candidates.", "specs": "Method: `_thought_generator`\nk: 3", "source": "backend/agents/path_planner_agent.py"}, "Eval": {"title": "State Evaluator", "desc": "Simulates learner's mental state to score path viability.", "logic": "1. 'Simulate student learning x'.\n2. Check Prerequisites.\n3. Predict Frustration.\n4. Score 0.0-1.0.", "specs": "Method: `_evaluate_path_viability`\nScore: 0.0-1.0", "source": "backend/agents/path_planner_agent.py"}, "Prune": {"title": "Beam Search Pruning", "desc": "Keeps top-k best paths, discards rest.", "logic": "1. Sort candidates by Score.\n2. Keep top-3 (Beam Width).\n3. Repeat for Depth=3.", "specs": "Beam Width (b): 3\nMax Depth (d): 3", "source": "backend/agents/path_planner_agent.py"}, "Bandit": {"title": "LinUCB Engine", "desc": "Contextual Multi-Armed Bandit for fast O(1) decision making.", "logic": "1. Calculate p_ta for each arm (concept).\n2. p_ta = Theta*x + Alpha*sqrt(Variance).\n3. Select argmax(p_ta).", "specs": "Alpha: 1.0\nFeatures: 10", "source": "backend/core/rl_engine.py"}, "Gate": {"title": "Probabilistic Mastery Gate", "desc": "Soft gate that allows exploration based on mastery probability.", "logic": "Prob = min(1.0, Score / 0.8).\nIf Random() > Prob -> Force Review.\nElse -> Pass.", "specs": "Formula: `min(1.0, score / 0.8)`\nFull Pass: 0.8", "source": "backend/agents/path_planner_agent.py"}};

        function showDetails(nodeId) {
            const data = NODE_DETAILS[nodeId];
            if (!data) return;

            document.getElementById('panel-title').innerText = data.title;
            document.getElementById('panel-desc').innerHTML = data.desc;
            
            // Logic Section (New)
            const logicEl = document.getElementById('panel-logic');
            if (data.logic) {
                logicEl.innerText = data.logic;
                logicEl.parentElement.style.display = 'block';
            } else {
                logicEl.parentElement.style.display = 'none';
            }

            document.getElementById('panel-specs').innerText = data.specs || "No specific configuration.";
            document.getElementById('panel-source').innerText = data.source || "System Component";
            
            document.getElementById('backdrop').classList.add('active');
            document.getElementById('detail-panel').classList.add('active');
        }

        function closeDetails() {
            document.getElementById('backdrop').classList.remove('active');
            document.getElementById('detail-panel').classList.remove('active');
        }

        // Auto-attach clicks after Mermaid renders
        // Note: We use the native mermaid click directive in the graph definition
    </script>
</body>
</html>
